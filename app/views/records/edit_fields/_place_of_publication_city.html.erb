<% # app/views/records/edit_fields/_place_of_publication_city.html.erb %>
<%= f.input key,
  as: :string,
  placeholder: 'Search for a location',
  input_html: {
    class: 'form-control',
    data: { 'multi-autocomplete': "place_of_publication_city", multiple: false  },
  },
  required: f.object.required?(key)
%>

<script>
  $(function() {
    $( '*[data-multi-autocomplete="place_of_publication_city"]' ).autocomplete({
      source: function(request, response) {
      	$.get("http://api.geonames.org/searchJSON",
                { q: request.term,
                  username: <%= config.geonames_username || raw('"hive"') %>,
                  maxRows: "10"
                },
                function(data) {
                  response_array = [];
                  $.each(data.geonames, function(index, value) {
                      response_array[index] = value;
                      response_array[index]["label"] = response_array[index]["name"];
                  });
                  response(response_array);
              });
      },
      minLength: 2,
      select: function( event, ui ) {
          event.preventDefault();
          $('*[data-multi-autocomplete="place_of_publication_city"]').val(ui.item.name);
  		    this.value = ui.item.name;
          $('#geoname').val(ui.item.geonameId);
          $('*[data-multi-autocomplete="place_of_publication"]').val(ui.item.geonameId);
      }
    });
  });
</script>
